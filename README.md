Java Soap WebService Demo
=========================

主要参考了<https://dzone.com/articles/simple-java-soap-web-service-using-jdk-tools>，感谢

- SOAP: "Simple Object Access Protocol"，简单对象访问协议（实际上一点也不简单，好繁琐）
- WSDL: "Web Services Description Language"

在看到REST的时候，感觉一切都很简单自然，有一种难道本来不就应该是这样的感觉。
然而看到了SOAP，才发现简单实际上来之不易，毕竟前人做了很多像SOAP这样繁琐无比的协议（还冠名为Simple)。

根据这个Demo得到的理解，就是通过http向外提供服务，暴露出一些方法供调用。客户端与服务器端之间的交互，使用了xml。

服务器端：

- 服务器端以url的方式暴露出一个“访问点”，比如：<http://localhost:1212/hello>
- 同时还需要提供一个url向客户端提供一个描述文件(wsdl)：http://localhost:1212/hello?wsdl

由于wsdl文件内容相当繁杂，以致于一个最简单的方法都需要成吨的描述，所以手写基本上不可能，好在可以通过工具
（比如jdk中提供的相关annotation），自动根据java代码生成。

客户端：

- 客户端想要简单的访问服务器端也不容易，必须定义一些相应的接口和代码等
- 好在jdk既提供了命令行工具`wsimport`根据wsdl文件生成相应的接口与代码，又提供了一些annotation简化代码
- 最后我们在自己的代码中引用生成的代码访问

感觉整个过程相当繁琐，每一步都很繁琐，难怪用的人少。

我觉得通常情况下有更好的替代品：

1. Rest
2. Protobuf: https://github.com/protocolbuffers/protobuf

## 服务器端代码

这一步在jdk内置的annotation和工具类的帮助下，比较简单，只需要提供一个普通的类、方法，再加上注解，再调用一些方法。

参看`demo.server.Hello`。

## 启动服务器代码

启动以后，会监听:

- `http://localhost:1212/hello`提供服务
- `http://localhost:1212/hello?wsdl`提供描述文件

如果查看<http://localhost:1212/hello?wsdl>，内容如下：

```
<!--
 Generated by JAX-WS RI (http://jax-ws.java.net). RI's version is JAX-WS RI 2.2.9-b130926.1035 svn-revision#5f6196f2b90e9460065a4c2f4e30e065b245e51e.
-->
<definitions xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd" xmlns:wsp="http://www.w3.org/ns/ws-policy" xmlns:wsp1_2="http://schemas.xmlsoap.org/ws/2004/09/policy" xmlns:wsam="http://www.w3.org/2007/05/addressing/metadata" xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/" xmlns:tns="http://demo/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://schemas.xmlsoap.org/wsdl/" targetNamespace="http://demo/" name="ServerService">
<types/>
<message name="hello">
<part name="arg0" type="xsd:string"/>
</message>
<message name="helloResponse">
<part name="return" type="xsd:string"/>
</message>
<portType name="Server">
<operation name="hello">
<input wsam:Action="http://demo/Server/helloRequest" message="tns:hello"/>
<output wsam:Action="http://demo/Server/helloResponse" message="tns:helloResponse"/>
</operation>
</portType>
<binding name="ServerPortBinding" type="tns:Server">
<soap:binding transport="http://schemas.xmlsoap.org/soap/http" style="rpc"/>
<operation name="hello">
<soap:operation soapAction=""/>
<input>
<soap:body use="literal" namespace="http://demo/"/>
</input>
<output>
<soap:body use="literal" namespace="http://demo/"/>
</output>
</operation>
</binding>
<service name="ServerService">
<port name="ServerPort" binding="tns:ServerPortBinding">
<soap:address location="http://localhost:1212/hello"/>
</port>
</service>
</definitions>
```

## 客户端生成帮助代码

需要先使用JDK中的一个`wsimport`工具，根据server提供的wsdl描述文件，生成相应的java接口，才能进一步调用。

```
cd src/main/java
wsimport -d . -p demo.wsclient -keep "http://localhost:1212/hello?wsdl"
```

它生成了`Server`接口和`ServiceService`类（甚至相应的`.class`文件都生成好了）

## 客户端调用代码

这一步看起来比较简单，直接调用刚才生成的代码，看起来就像是一个普通的本地方法调用。

## Logging

由于辅助代码把细节都隐藏起来了，所以调用完了也不知道客户端与服务器端到底发送了什么数据。

可以在服务器端打开几个日志选项，得到以下日志：

```
---[HTTP request]---
Accept: text/xml, multipart/related
Connection: keep-alive
Host: localhost:1212
User-agent: JAX-WS RI 2.2.9-b130926.1035 svn-revision#5f6196f2b90e9460065a4c2f4e30e065b245e51e
Content-type: text/xml; charset=utf-8
Soapaction: "http://server.demo/Hello/helloRequest"
Content-length: 188
<?xml version="1.0" ?><S:Envelope xmlns:S="http://schemas.xmlsoap.org/soap/envelope/"><S:Body><ns2:hello xmlns:ns2="http://server.demo/"><arg0>soap</arg0></ns2:hello></S:Body></S:Envelope>--------------------

---[HTTP response 200]---
Date: Thu, 07 Feb 2019 08:08:28 GMT
Transfer-encoding: chunked
Content-type: text/xml; charset=utf-8
<?xml version="1.0" ?><S:Envelope xmlns:S="http://schemas.xmlsoap.org/soap/envelope/"><S:Body><ns2:helloResponse xmlns:ns2="http://server.demo/"><return>Hello, soap!</return></ns2:helloResponse></S:Body></S:Envelope>--------------------
```

可以看到，服务器端与客户端之间发送的是xml，通过一层层奇怪而复杂的包装来传递数据
